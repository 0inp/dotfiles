# vim:ft=tmux

######################
#### General Settings ####
######################

# tmux display things in 256 colors
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# enable mouse support for switching panes/windows
setw -g mouse on

set -g history-limit 20000

# automatically renumber tmux windows
set -g renumber-windows on

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# # automatically rename windows when an explicit name is not set
# set-option -g status-interval 1
# set-option -g automatic-rename on
# # set-option -g automatic-rename-format "#{?#{==:#{pane_current_command},zsh},#{b:pane_current_path},#{pane_current_command}}"# set the default title format
# set-option -g automatic-rename-format ""
# set-option -g set-titles-string "#T - #W"

# Set window notifications
setw -g monitor-activity on
set -g visual-activity on

set-window-option -g other-pane-height 25
set-window-option -g other-pane-width 80

set -g set-clipboard on

run-shell "tmux setenv -g TMUX_VERSION $(tmux -V | cut -c 6-)"

set-window-option -g display-panes-time 1500

# Allow the arrow key to be used immediately after changing windows
set-option -g repeat-time 0

# Disable assume-paste-time, so that iTerm2"s "Send Hex Codes" feature works
# with tmux 2.1. This is backwards-compatible with earlier versions of tmux,
# AFAICT.
set-option -g assume-paste-time 0

# ######################
# #### Key Bindings ####
# ######################
# split panes using | and -
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# tile all windows
unbind =
bind = select-layout tiled

# synchronize all panes in a window
bind y setw synchronize-panes

# more settings to make copy-mode more vim-like
unbind [
bind Escape copy-mode
unbind p
bind p paste-buffer
bind -T copy-mode-vi v send -X begin-selection

bind-key : command-prompt
bind-key B refresh-client
bind-key L clear-history

bind-key enter next-layout
bind-key a last-pane
bind-key q display-panes
bind-key c new-window
# same default binding without confirm-before
bind-key & kill-window
bind-key x kill-pane


bind-key C-o rotate-window

# Fix to allow mousewheel/trackpad scrolling in tmux 2.1
bind-key -T root WheelUpPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; copy-mode -e; send-keys -M"
bind-key -T root WheelDownPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; send-keys -M"


# To launch fuzzy-sheets in a tmux window
bind-key i run-shell "tmux neww ~/dotfiles/resources/chtfzf.sh -t"

######################
####    Plugins    ###
######################
set-environment -g TMUX_PLUGIN_MANAGER_PATH "~/.tmux/plugins/"

# List of plugins
# Supports `github_username/repo` or full git URLs
set -g @plugin "tmux-plugins/tpm"
# Set of valid options
set -g @plugin "tmux-plugins/tmux-sensible"
# vi-mode navigation tmux/vi pane
set -g @plugin "christoomey/vim-tmux-navigator"
# fzf wrapper for tmux <prefix>+S-f
set -g @plugin "sainnhe/tmux-fzf"
# Better copy mode
set -g @plugin "tmux-plugins/tmux-yank"
# Better windows names
set -g @plugin "ofirgall/tmux-window-name"
set -g @tmux_window_dir_programs "["nvim", "git"]"
# persist tmux sessions after computer restart
set -g @plugin "tmux-plugins/tmux-resurrect"
set -g @resurrect-dir "~/.tmux/resurrect"
 # allow tmux-ressurect to capture pane contents
set -g @resurrect-capture-pane-contents "on"
# Automatic save of tmux session
set -g @plugin "tmux-plugins/tmux-continuum"
set -g @continuum-save-interval "1"
set -g @continuum-restore "on"
# set -g status-left "Continuum status: #{continuum_status}"
# fuzzy find text on screen <prefix>+Tab
set -g @plugin "laktak/extrakto"

# Dracula Theme
set -g @plugin "dracula/tmux"
# available plugins: battery, cpu-usage, git, gpu-usage, ram-usage, tmux-ram-usage, network, network-bandwidth, network-ping, attached-clients, network-vpn, weather, time, spotify-tui, kubernetes-context, synchronize-panes
set -g @dracula-plugins "continuum network time battery"
set -g @dracula-show-powerline true
set -g @dracula-day-month true
set -g @dracula-show-timezone false
set -g @dracula-show-flags false
set -g @dracula-show-left-icon session
# set -g @dracula-continuum-mode time
# set -g @dracula-continuum-time-threshold 60

set -g status-position top
run "~/.tmux/plugins/tpm/tpm"
